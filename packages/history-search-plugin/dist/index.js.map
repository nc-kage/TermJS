{"version":3,"file":"index.js","sources":["../src/HistorySearch/constants.ts","../src/HistorySearch/index.ts"],"sourcesContent":["export const PLUGIN_NAME = 'history-search-plugin';\nexport const HISTORY_KEY_CODE = 89;\nexport const IS_MAC = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n","import { uniq } from 'lodash-es';\n\nimport '@term-js/autocomplete-plugin/dist/index.css';\n\nimport { Plugin, ITermInfo, IKeyboardShortcutsManager, ActionShortcutType } from '@term-js/term';\nimport { Autocomplete, IAutocomplete } from '@term-js/autocomplete-plugin';\n\nimport icon from './icon.html';\n\nimport IHistorySearch from '@HistorySearch/IHistorySearch';\nimport { PLUGIN_NAME, HISTORY_KEY_CODE, IS_MAC } from '@HistorySearch/constants';\n\nclass HistorySearch extends Plugin implements IHistorySearch {\n  public readonly name: string = PLUGIN_NAME;\n\n  private autocomplete?: IAutocomplete;\n  private removeList?: () => void;\n  private history: string[] = [];\n  private readonly actionShortcut: ActionShortcutType = {\n    code: HISTORY_KEY_CODE, meta: IS_MAC, ctrl: !IS_MAC,\n  };\n\n  constructor(actionShortcut?: ActionShortcutType) {\n    super();\n    if (actionShortcut) this.actionShortcut = actionShortcut;\n  }\n\n  public setTermInfo(termInfo: ITermInfo, keyboardShortcutsManager: IKeyboardShortcutsManager) {\n    super.setTermInfo(termInfo, keyboardShortcutsManager);\n    this.setAutocomplete();\n    this.setHistoryList();\n  }\n\n  public updateTermInfo(termInfo: ITermInfo) {\n    super.updateTermInfo(termInfo);\n    this.setHistoryList();\n  }\n\n  public clear() {\n    const { autocomplete } = this;\n    if (autocomplete) autocomplete.clear();\n    super.clear();\n  }\n\n  public destroy() {\n    this.clear();\n    super.destroy();\n  }\n\n  private setAutocomplete() {\n    const { termInfo } = this;\n    if (!termInfo) return;\n    const autocomplete = termInfo.pluginManager.getPlugin(Autocomplete);\n    if (autocomplete) return this.autocomplete = autocomplete as IAutocomplete;\n    this.autocomplete = new Autocomplete();\n    termInfo.pluginManager.register(this.autocomplete);\n  }\n\n  private setHistoryList() {\n    const { termInfo, removeList, autocomplete } = this;\n    if (!termInfo || !autocomplete) return;\n    if (this.checkUpdateHistoryList()) {\n      if (removeList) removeList();\n      this.removeList = autocomplete.addList(this.history, this.actionShortcut, icon);\n    }\n  }\n\n  private checkUpdateHistoryList(): boolean {\n    const { history } = this;\n    const newHistory = uniq(this.termInfo?.history || []);\n    const isUpdated = newHistory.length && (history.length !== newHistory.length\n      || newHistory.some((item, i) => item !== history[i]));\n    if (isUpdated) {\n      this.history = newHistory;\n      return true;\n    }\n    return false;\n  }\n}\n\nexport default HistorySearch;\n"],"names":["Plugin","Autocomplete","uniq"],"mappings":";;;;;;;;;;AAAO,MAAM,WAAW,GAAG,uBAAuB,CAAC;AAC5C,MAAM,gBAAgB,GAAG,EAAE,CAAC;AAC5B,MAAM,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC;;ACU1E,MAAM,aAAc,SAAQA,WAAM;IAUhC,YAAY,cAAmC;QAC7C,KAAK,EAAE,CAAC;QAVM,SAAI,GAAW,WAAW,CAAC;QAInC,YAAO,GAAa,EAAE,CAAC;QACd,mBAAc,GAAuB;YACpD,IAAI,EAAE,gBAAgB,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,MAAM;SACpD,CAAC;QAIA,IAAI,cAAc;YAAE,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC;KAC1D;IAEM,WAAW,CAAC,QAAmB,EAAE,wBAAmD;QACzF,KAAK,CAAC,WAAW,CAAC,QAAQ,EAAE,wBAAwB,CAAC,CAAC;QACtD,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,CAAC,cAAc,EAAE,CAAC;KACvB;IAEM,cAAc,CAAC,QAAmB;QACvC,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAC/B,IAAI,CAAC,cAAc,EAAE,CAAC;KACvB;IAEM,KAAK;QACV,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC;QAC9B,IAAI,YAAY;YAAE,YAAY,CAAC,KAAK,EAAE,CAAC;QACvC,KAAK,CAAC,KAAK,EAAE,CAAC;KACf;IAEM,OAAO;QACZ,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,KAAK,CAAC,OAAO,EAAE,CAAC;KACjB;IAEO,eAAe;QACrB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,QAAQ;YAAE,OAAO;QACtB,MAAM,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,CAACC,+BAAY,CAAC,CAAC;QACpE,IAAI,YAAY;YAAE,OAAO,IAAI,CAAC,YAAY,GAAG,YAA6B,CAAC;QAC3E,IAAI,CAAC,YAAY,GAAG,IAAIA,+BAAY,EAAE,CAAC;QACvC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;KACpD;IAEO,cAAc;QACpB,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC;QACpD,IAAI,CAAC,QAAQ,IAAI,CAAC,YAAY;YAAE,OAAO;QACvC,IAAI,IAAI,CAAC,sBAAsB,EAAE,EAAE;YACjC,IAAI,UAAU;gBAAE,UAAU,EAAE,CAAC;YAC7B,IAAI,CAAC,UAAU,GAAG,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;SACjF;KACF;IAEO,sBAAsB;;QAC5B,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC;QACzB,MAAM,UAAU,GAAGC,aAAI,CAAC,OAAA,IAAI,CAAC,QAAQ,0CAAE,OAAO,KAAI,EAAE,CAAC,CAAC;QACtD,MAAM,SAAS,GAAG,UAAU,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM,KAAK,UAAU,CAAC,MAAM;eACvE,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC,KAAK,IAAI,KAAK,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACxD,IAAI,SAAS,EAAE;YACb,IAAI,CAAC,OAAO,GAAG,UAAU,CAAC;YAC1B,OAAO,IAAI,CAAC;SACb;QACD,OAAO,KAAK,CAAC;KACd;;;;;"}